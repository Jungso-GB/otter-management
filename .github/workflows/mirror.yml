name: Mirror Repo

on:
  push:
    branches: [ main ] # adapte si ta branche principale est dev ou master

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: V√©rifier que le token est bien lu
        run: |
          if [ -z "$TOKEN" ]; then
            echo "‚ùå Le token est VIDE. V√©rifie ton secret dans Settings > Secrets du d√©p√¥t source."
            exit 1
          else
            echo "‚úÖ Token d√©tect√©, longueur : ${#TOKEN} caract√®res"
          fi
        env:
          TOKEN: ${{ secrets.TOKEN }}

      - name: Tester l'acc√®s au d√©p√¥t cible
        run: |
          echo "üîç Test de connexion avec git ls-remote..."
          git ls-remote https://${{ secrets.TOKEN }}@github.com/mafiaotters/otter-management.git

      - name: Configurer l'identit√© Git
        run: |
          git config user.name "Mirror Bot"
          git config user.email "mirror-bot@users.noreply.github.com"

      - name: Pousser vers le d√©p√¥t miroir
        run: |
          git remote add mirror https://${{ secrets.TOKEN }}@github.com/mafiaotters/otter-management.git
          git push --mirror mirror
